---
title: 你不知道的Javascript上卷——上
date: 2018-03-26 14:28:08
tags: 读书笔记
category: 读书笔记
---
## 概述
一直都想好好读一下这本书，很多同行安利过了。每次都是读一点都读不下去，最近很仔细的品读了一下，真的非常棒，读完之后受益匪浅。
这次的读书笔记是读完本书上卷的前半部分——作用域和闭包之后写的。

#### 作用域是什么
一言以蔽之，作用域是一套完整的变量存储的规则。
变量存在哪里，怎么找到这个变量，都是这套规则决定的。

##### 编译原理
最初学习js的时候就会说js是一门解释性的语言，事实上他是编译语言，但是又和传统的编译语言不一样，比如JAVA，js并不是提前编译的，编译的结果也不能在分布式系统中进行移植。
对于传统的语言，代码执行之前有3个步骤，分词/词法分析 => 解析/语法分析 => 代码生成

##### 理解作用域
引擎：从头到尾负责整个js的编译和执行过程

编译器： 引擎的好朋友，负责语法分析和代码生成

作用域：收集和维护所有的变量组成一系列查询和一套严格的规则。

#### 词法作用域
词法作用域就是定义在词法阶段的作用域。换句话说，词法作用域是由你在写代码时将变量和块级作用域写在哪里来决定的。欺骗词法，eval和with，对性能会有影响。

#### 函数作用域和块作用域
函数作用域是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用。
 
块作用域：IIFE，let，const，try

**变量提升中函数优先**

#### 闭包
闭包是基于词法作用域书写产生的自然结果。函数在定义时的词法作用域以外的地方被调用，闭包可以让函数继续访问定义时的词法作用域。

```javascript

function wait(msg){
    setTimeout(function timer(){
        console.log(msg)
    },1000)
}

wait('hello closure')
```
将内部函数（timer）传递给setTimeout，timer具有覆盖wait的作用域，
wait执行1000ms后，他的作用域不会消失，timer依然保持对wait作用域的闭包

##### 循环和闭包
经典面试题
```js
for(var i = 0;i<5; i++){
	setTimeout(function(){
		console.log(i)
	},i*2000)
}
```
首先 setTimeout中的回调会在循环之后执行
var 没有块作用域，所有的i都在全局作用域，最后打印的只能是5

可以采用IIFE和let

```js
for(let i = 0;i<5; i++){
	setTimeout(function(){
		console.log(i)
	},i*2000)
}
```

```js
for(var i = 0;i<5; i++){
	((i)=>{
		setTimeout(function(){
		console.log(i)
	},i*2000)
	})(i)
}
```

## 小结
书中有很多原理性知识的讲解，但是不想浪费时间去截取了。直接看书就很好啦。